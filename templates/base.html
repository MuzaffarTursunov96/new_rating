<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Company Reviews</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  rel="stylesheet"
  />
  <!-- Google Fonts -->
  <link
  href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
  rel="stylesheet"
  />
  <!-- MDB -->
  <link
  href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.css"
  rel="stylesheet"
  />

  <!-- MDB -->
<script
type="text/javascript"
src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.js"
></script>




<!-- default styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/css/star-rating.min.css" media="all" rel="stylesheet" type="text/css" />

<!-- with v4.1.0 Krajee SVG theme is used as default (and must be loaded as below) - include any of the other theme CSS files as mentioned below (and change the theme property of the plugin) -->
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.css" media="all" rel="stylesheet" type="text/css" />

<!-- important mandatory libraries -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/js/star-rating.min.js" type="text/javascript"></script>

<!-- with v4.1.0 Krajee SVG theme is used as default (and must be loaded as below) - include any of the other theme JS files as mentioned below (and change the theme property of the plugin) -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.js"></script>

<!-- optionally if you need translation for your language then include locale file as mentioned below (replace LANG.js with your own locale file) -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/js/locales/LANG.js"></script>



  <script>
   $("#input-id").rating();
// with plugin options (do not attach the CSS class "rating" to your input if using this approach)
$("#input-id").rating({'size':'sm'});


  </script>


</head>
<body>
  <div class="container">
 
    <div class="d-flex  mt-2" >
      <div class="mr-auto p-2"><h4>Отзывы </h4><br><span class="badge badge-pill badge-light" style="color: rgba(0,0,0,0.3);">Честные отзывы о бизнесе</span></div>
      <div class="p-2 mr-2"><a href="{% url 'index' %}" class="text-dark" style="text-decoration: none;">Главная</a> </div>
      <div class="p-2 mr-3"><a href="" class="text-dark" style="text-decoration: none;">Пример страницы</a> </div>
      <div class="p-2">
        <button type="button" style="height: 40px;" class="btn btn-success btn-sm text-right" data-mdb-toggle="modal" data-mdb-target="#exampleModal">
          
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
          </svg>
            Добавить обьявление
        </button>
        <!-- <button type="button" class="btn btn-success btn-sm text-right" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">
        </button> -->
        
      </div>
    </div>
    <hr class=" m-0 p-0">

    

{% block content %}

{% endblock %}

{% include 'footer.html' %}

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Добавить Компанию </h5>
        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="formcompany" action="/">
          <!-- Name input -->
          {% csrf_token %}
          <div class="form-outline mb-1 ">
            <label class="form-label" >Имя компании *</label>
            <input type="text" id="company_name" class="form-control bg-light"  required />
          </div>
        
          <div class="form-outline mb-1">
            <label class="form-label" >ИНН компании * </label>
            <input type="text" id="company_inn" class="form-control bg-light" required />
          </div>
          <div class="form-outline mb-1">
            <label class="form-label">Адрес компании *</label>
            <input type="text" id="company_address" class="form-control bg-light" required />
          </div>
          <div class="form-outline mb-1">
            <label class="form-label">Телефон компании *</label>
            <input type="text" id="company_phone" class="form-control bg-light"  required />
          </div>
        
          <!-- Message input -->
          <div class="form-outline mb-1">
            <label  >Сообщения * </label>
            <textarea class="form-control bg-light"  rows="4" required  id="company_msg"></textarea>
          </div>
         
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="company_save()">Save changes</button>
      </div>
    </form>
    </div>
  </div>
</div>

<div class="modal" tabindex="-1" id="exampleModal2"  aria-labelledby="exampleModalLabel2"  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Коммент</h5>
        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="formcomment">
          {% csrf_token %}
          <!-- Name input -->
          <div class="form-outline mb-1 ">
            <label class="form-label" >Имя *</label>
            <input type="text" id="name" class="form-control bg-light" required />
          </div>
        
          <!-- Email input -->
          <div class="form-outline mb-1">
            <label class="form-label" >Е-почта *</label>
            <input type="email" class="form-control bg-light" id="email" required />
          </div>
          <!-- Message input -->
          <div class="form-outline mb-1">
            <label class="form-label" >Комментарии *</label>
            <textarea class="form-control bg-light"  rows="4" name="comment" id="comment" required ></textarea>
          </div>
          <input id="input-id" type="text" class="rating" data-size="sm" required>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="comment_save()">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>

function datasort(){

var options =  $('#datesort option:selected').val();
location.href="{% url 'sort'%}"+'?sort='+options;
// url="{% url 'sort' %}";
// var csrftoken =document.querySelector('[name="csrfmiddlewaretoken"]').value;
// $.ajax({
//       type:'POST',
//       url:url,
//       data:{
//         'sort':options,
//         'csrfmiddlewaretoken':csrftoken

//       },
//       success:function(response){
//         print(response)
//        }

//     });

}

  function company_save(){
    console.log('salom')
    var name =document.getElementById('company_name').value;
    // var modal =document.getElementById('exampleModal');
    const myModalEl = document.getElementById('exampleModal');
    var inn =document.getElementById('company_inn').value;
  
    var company_address =document.getElementById('company_address').value;
    var company_phone =document.getElementById('company_phone').value;
    var company_msg =document.getElementById('company_msg').value;
    
    var csrftoken =document.querySelector('[name="csrfmiddlewaretoken"]').value;
    
 
    var url ="{% url 'company_save' %}";
   
    $.ajax({
      type:'POST',
      url:url,
      data:{
        'name':name,
        'inn':inn,
        'address':company_address,
        'phone':company_phone,
        'msg':company_msg,
        'csrfmiddlewaretoken':csrftoken

      },
      success:function(response){
      

        if(response.status=='Success'){
          Swal.fire(
          response.msg,
          'You clicked the button!',
          'success'
        );
        }else{
          Swal.fire(
          response.msg,
          'Cancel!',
          'error'
        );
        }
        document.getElementById('formcompany').reset();
        const element = document.querySelector('.modal-backdrop');
        element.remove();
        myModalEl.style='display:none';
        location.reload(true);
        // window.location.href=order_complete + '?order_num='+response.order_number+'&trans_id='+response.transaction_id
      }

    });
  }
  function comment_save(){
   
    var company_id ='{{company.id}}'
    
    var name =document.getElementById('name').value;
    // var modal =document.getElementById('exampleModal');
    const myModalEl = document.getElementById('exampleModal2');
    var email =document.getElementById('email').value;
  
    var comment =document.getElementById('comment').value;
    
    var csrftoken =document.querySelector('[name="csrfmiddlewaretoken"]').value;
    
    var caption =$('.caption').text();
    // console.log(caption);
    if (caption =='Not Rated'){
      rating =0;
    }else if(caption =='Half Star'){
      rating =0.5
    }
    else if(caption =='One Star'){
      rating =1
    }
    else if(caption =='One & Half Star'){
      rating =1.5
    }
    else if(caption =='Two Stars'){
      rating =2
    }
    else if(caption =='Two & Half Stars'){
      rating =2.5
    }
    else if(caption =='Three Stars'){
      rating =3
    }
    else if(caption =='Three & Half Stars'){
      rating =3.5
    }
    else if(caption =='Four Stars'){
      rating =4
    }
    else if(caption =='Four & Half Stars'){
      rating =4.5
    }
    else if(caption =='Five Stars'){
      rating =5
    }
    console.log(rating);
    var url ="{% url 'comment_save' %}";
    $.ajax({
      type:'POST',
      url:url,
      data:{
        'name':name,
        'email':email,
        'msg':comment,
        'rating':rating,
        'company_id':company_id,
        'csrfmiddlewaretoken':csrftoken

      },
      success:function(response){
      

        if(response.status=='Success'){
          Swal.fire(
          response.msg,
          'You clicked the button!',
          'success'
        );
        }else{
          Swal.fire(
          response.msg,
          'Cancel!',
          'error'
        );
        }
        document.getElementById('formcomment').reset();
        const element = document.querySelector('.modal-backdrop');
        element.remove();
        myModalEl.style='display:none';
        location.reload(true);
        
      }

    });
  }
</script>

